<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selbsteinsch√§tzung - BBW Digitale Kompetenzen</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            min-height: calc(100vh - 40px);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .back-button {
            display: inline-block;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: background 0.3s;
        }

        .back-button:hover {
            background: #5a67d8;
        }

        h1 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #718096;
            font-size: 1.1em;
        }

        /* Code Entry Section */
        .code-entry {
            background: #f8f9fa;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }

        .code-entry h2 {
            color: #495057;
            margin-bottom: 20px;
        }

        .code-input-group {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin: 30px 0;
        }

        .code-input {
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            width: 250px;
            text-align: center;
            text-transform: uppercase;
        }

        .code-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .start-button {
            padding: 15px 40px;
            background: #FF6B6B;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .start-button:hover {
            background: #E53E3E;
            transform: translateY(-2px);
        }

        .start-button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        /* Test Section */
        .test-section {
            display: none;
        }

        .test-section.active {
            display: block;
        }

        /* Progress Bar */
        .progress-container {
            background: #e9ecef;
            border-radius: 10px;
            height: 30px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Section Header */
        .section-header {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .section-title {
            font-size: 1.8em;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .section-description {
            color: #718096;
            font-size: 1em;
            line-height: 1.6;
        }

        /* Question Card */
        .question-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .question-card.answered {
            border-color: #667eea;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .category-badge {
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-size: 0.9em;
            font-weight: bold;
        }

        .category-1 { background: #3887be; }
        .category-2 { background: #28a745; }
        .category-3 { background: #e74c3c; }
        .category-4 { background: #8e44ad; }
        .category-5 { background: #e67e22; }

        .question-text {
            font-size: 1.1em;
            color: #2d3748;
            margin-bottom: 20px;
            line-height: 1.6;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        /* Info Button */
        .info-button {
            min-width: 30px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .info-button:hover {
            background: #5a67d8;
            transform: scale(1.1);
        }

        /* Info Box */
        .info-box {
            display: none;
            background: #e8f4ff;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            animation: slideDown 0.3s ease;
        }

        .info-box.active {
            display: block;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-box h4 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .info-box p {
            color: #4a5568;
            font-size: 0.9em;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .concept-tags {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .concept-tag {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .ikt-tag {
            background: #d6e8f5;
            color: #3887be;
        }

        .paed-tag {
            background: #fce5e2;
            color: #e74c3c;
        }

        /* Answer Options */
        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .answer-option {
            padding: 12px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }

        .answer-option:hover {
            border-color: #667eea;
            background: #f7f7ff;
        }

        .answer-option input[type="radio"] {
            margin-right: 15px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .answer-option label {
            cursor: pointer;
            flex: 1;
            font-size: 0.95em;
        }

        .answer-option.selected {
            border-color: #667eea;
            background: #f0f0ff;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            position: sticky;
            bottom: 0;
            background: white;
            padding: 20px 0;
        }

        .nav-button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .prev-button {
            background: #e9ecef;
            color: #495057;
        }

        .prev-button:hover {
            background: #dee2e6;
        }

        .next-button {
            background: #667eea;
            color: white;
        }

        .next-button:hover {
            background: #5a67d8;
        }

        .submit-button {
            background: #28a745;
            color: white;
        }

        .submit-button:hover {
            background: #218838;
        }

        /* Results Section */
        .results-section {
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .results-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            font-weight: bold;
            color: white;
        }

        .score-excellent { background: linear-gradient(135deg, #28a745, #20c997); }
        .score-good { background: linear-gradient(135deg, #ffc107, #fd7e14); }
        .score-needs-improvement { background: linear-gradient(135deg, #dc3545, #c82333); }

        .category-results {
            margin: 30px 0;
        }

        .category-result {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .category-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .category-result-title {
            font-weight: bold;
            color: #2d3748;
        }

        .category-result-score {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            background: white;
        }

        .result-bar-container {
            background: #e9ecef;
            border-radius: 5px;
            height: 20px;
            overflow: hidden;
        }

        .result-bar {
            height: 100%;
            border-radius: 5px;
            transition: width 1s ease;
        }

        /* Recommendations */
        .recommendations {
            background: #f0f8ff;
            border: 2px solid #667eea;
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
        }

        .recommendations h3 {
            color: #495057;
            margin-bottom: 20px;
        }

        .recommendation-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .action-button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .print-button {
            background: #6c757d;
            color: white;
        }

        .print-button:hover {
            background: #5a6268;
        }

        .restart-button {
            background: #667eea;
            color: white;
        }

        .restart-button:hover {
            background: #5a67d8;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .code-input {
                width: 200px;
            }

            .question-text {
                font-size: 1em;
            }

            .nav-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .nav-button {
                width: 100%;
            }
        }

        @media print {
            body {
                background: white;
            }
            
            .container {
                box-shadow: none;
                padding: 20px;
            }

            .back-button,
            .action-buttons,
            .info-button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-button">‚Üê Zur√ºck zur Startseite</a>
        
        <div class="header">
            <h1>Selbsteinsch√§tzung</h1>
            <p class="subtitle">√úberpr√ºfen Sie Ihre digitalen Kompetenzen</p>
        </div>

        <!-- Code Entry Section -->
        <div id="codeEntry" class="code-entry">
            <h2>Zugangs-Code eingeben</h2>
            <p>Bitte geben Sie den Code ein, den Sie von Ihrer Abteilungsleitung erhalten haben.</p>
            <div class="code-input-group">
                <input type="text" 
                       id="accessCode" 
                       class="code-input" 
                       placeholder="CODE-XXXX" 
                       maxlength="10">
                <button id="startTest" class="start-button" onclick="startTest()">
                    Test starten
                </button>
            </div>
            <p style="color: #6c757d; font-size: 0.9em; margin-top: 20px;">
                Der Code dient zur anonymen Zuordnung Ihrer Ergebnisse zu Ihrer Abteilung.
            </p>
        </div>

        <!-- Test Section -->
        <div id="testSection" class="test-section">
            <div class="progress-container">
                <div id="progressBar" class="progress-bar" style="width: 0%">
                    Bereich 1 von 5
                </div>
            </div>

            <div id="sectionContainer">
                <!-- Section content will be dynamically inserted here -->
            </div>

            <div class="nav-buttons">
                <button id="prevButton" class="nav-button prev-button" onclick="previousSection()">
                    ‚Üê Vorheriger Bereich
                </button>
                <button id="nextButton" class="nav-button next-button" onclick="nextSection()">
                    N√§chster Bereich ‚Üí
                </button>
                <button id="submitButton" class="nav-button submit-button" onclick="submitTest()" style="display: none;">
                    Test abschliessen
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="results-section">
            <div class="results-header">
                <h2>Ihre Ergebnisse</h2>
                <div id="scoreCircle" class="score-circle">
                    <!-- Score will be inserted here -->
                </div>
                <p id="scoreText" style="font-size: 1.2em; color: #495057;"></p>
            </div>

            <div id="categoryResults" class="category-results">
                <!-- Category results will be inserted here -->
            </div>

            <div id="recommendations" class="recommendations">
                <h3>Empfohlene Entwicklungsmassnahmen</h3>
                <div id="recommendationsList">
                    <!-- Recommendations will be inserted here -->
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-button print-button" onclick="window.print()">
                    üìÑ Ergebnisse drucken
                </button>
                <button class="action-button restart-button" onclick="restartTest()">
                    üîÑ Neuer Test
                </button>
            </div>
        </div>
    </div>

    <!-- Firebase Configuration -->
    <script>
        window.__firebase_config = JSON.stringify({
            apiKey: "AIzaSyCHhycjQmHU00_dQl5Xdo5PZCTn8JODk20",
            authDomain: "ikt-komp-bbw.firebaseapp.com",
            projectId: "ikt-komp-bbw",
            storageBucket: "ikt-komp-bbw.firebasestorage.app",
            messagingSenderId: "154620660911",
            appId: "1:154620660911:web:20d389d699d2f0d2c2d85a",
            measurementId: "G-JZ1VC46184"
        });
    </script>

    <!-- Main Application Script with Firebase -->
    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Firebase initialisieren
        let db = null;
        let firebaseReady = false;
        
        try {
            const firebaseConfig = JSON.parse(window.__firebase_config);
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            firebaseReady = true;
            console.log("Firebase initialisiert f√ºr Selbsttest");
        } catch (e) {
            console.warn("Firebase nicht verf√ºgbar, nutze lokalen Speicher:", e);
        }

        // Test Questions Database with additional info - KORRIGIERT
        const sections = [
            {
                id: 1,
                name: "Grundkenntnisse IKT",
                description: "Grundlegende technische F√§higkeiten zum Umgang mit digitalen Ger√§ten, Anwendungen und Systemen als Fundament f√ºr digitale Lehr- und Lernszenarien.",
                questions: [
                    {
                        id: 1,
                        text: "Wie sicher f√ºhlen Sie sich beim Verbinden von technischen Ger√§ten (z.B. Beamer, Drucker) mit Ihrem Computer?",
                        info: {
                            examples: "Beamer √ºber HDMI/VGA verbinden, Drucker im Netzwerk einrichten, Smartphone mit dem PC koppeln, WLAN verbinden, Hotspot einrichten",
                            tools: "Windows-Einstellungen, W-Lan, Verbindungskabel",
                            tips: "Halten Sie Verbindungskabel und Adapter bereit. Dokumentieren Sie funktionierende Einstellungen f√ºr zuk√ºnftige Verwendung.",
                            ikt: "RE üíö - Ressourceneffizienz",
                            paed: "PDM üõ†Ô∏è - Didaktik & Methoden"
                        },
                        options: [
                            { value: 4, text: "Sehr sicher - Ich kann problemlos verschiedene Ger√§te verbinden und konfigurieren" },
                            { value: 3, text: "Sicher - Ich kann die meisten Ger√§te ohne Hilfe verbinden" },
                            { value: 2, text: "Teilweise sicher - Manchmal ben√∂tige ich Unterst√ºtzung" },
                            { value: 1, text: "Unsicher - Ich ben√∂tige oft Hilfe beim Verbinden von Ger√§ten" }
                        ]
                    },
                    {
                        id: 2,
                        text: "Wie gut k√∂nnen Sie Office-Programme (Word, Excel, PowerPoint) f√ºr die Erstellung von Unterrichtsmaterialien nutzen?",
                        info: {
                            examples: "Arbeitsbl√§tter mit Formatvorlagen erstellen, Excel f√ºr Notenverwaltung nutzen, interaktive PowerPoint-Pr√§sentationen, Serienbriefe f√ºr interne Kommunikation",
                            tools: "Microsoft 365, M365 Office Online",
                            tips: "Nutzen Sie Vorlagen f√ºr wiederkehrende Dokumente. Setzen Sie Office-Dokumente zeitsparend ein",
                            ikt: "MV üîÑ - Medienvielfalt",
                            paed: "PDM üõ†Ô∏è - Methodenvielfalt"
                        },
                        options: [
                            { value: 4, text: "Ich nutze erweiterte Funktionen wie Makros, Vorlagen und Automatisierungen" },
                            { value: 3, text: "Ich kann ansprechende Materialien mit verschiedenen Funktionen erstellen" },
                            { value: 2, text: "Ich kann einfache Dokumente und Pr√§sentationen erstellen" },
                            { value: 1, text: "Ich kenne nur die Basisfunktionen" }
                        ]
                    },
                    {
                        id: 3,
                        text: "Wie routiniert nutzen Sie Cloud-Dienste (OneDrive, Teams) f√ºr Ihre Unterrichtsvorbereitung?",
                        info: {
                            examples: "Materialien in OneDrive speichern und teilen, Kollaborative Dokumente in Teams, Automatische Synchronisierung zwischen Ger√§ten, Versionsverwaltung von Dokumenten",
                            tools: "Microsoft OneDrive, Teams, SharePoint, Google Drive",
                            tips: "Strukturieren Sie Ihre Cloud-Ordner nach Klassen und F√§chern. Nutzen Sie die Freigabefunktionen f√ºr die Zusammenarbeit.",
                            ikt: "KN üåê - Vernetzung",
                            paed: "PDM üõ†Ô∏è - Digitale Methoden"
                        },
                        options: [
                            { value: 4, text: "Cloud-Dienste sind integraler Bestandteil meiner Arbeit" },
                            { value: 3, text: "Ich nutze Cloud-Dienste regelm√§ssig" },
                            { value: 2, text: "Ich nutze Cloud-Dienste selten" },
                            { value: 1, text: "Ich arbeite haupts√§chlich lokal" }
                        ]
                    }
                ]
            },
            {
                id: 2,
                name: "Anwendung im Unterricht",
                description: "Praktische Implementierung digitaler Medien in den Unterrichtsprozess. Digitale Technologien didaktisch sinnvoll in allen Phasen des Unterrichts einsetzen.",
                questions: [
                    {
                        id: 4,
                        text: "Wie h√§ufig setzen Sie digitale Werkzeuge oder KI-Tools f√ºr die Erstellung von Lernmaterialien ein?",
                        info: {
                            examples: "ChatGPT f√ºr Aufgabenerstellung, Canva f√ºr Infografiken, to-teach.ai f√ºr interaktive √úbungen, KI-Bildgeneratoren f√ºr Illustrationen",
                            tools: "Fobizz, to-teach.ai, Canva, H5P, Adobe Express",
                            tips: "Beginnen Sie mit einem Tool und erweitern Sie schrittweise. Pr√ºfen Sie KI-generierte Inhalte immer auf Richtigkeit.",
                            ikt: "RE üíö - Effizienz",
                            paed: "PDM üõ†Ô∏è - Innovative Methoden"
                        },
                        options: [
                            { value: 4, text: "Bei fast jeder Unterrichtsvorbereitung" },
                            { value: 3, text: "Bei den meisten Unterrichtsvorbereitungen" },
                            { value: 2, text: "Es kommt immer wieder vor, es aber nicht die Regel" },
                            { value: 1, text: "Selten oder nie" }
                        ]
                    },
                    {
                        id: 5,
                        text: "Wie interaktiv gestalten Sie Ihren Unterricht mit digitalen Tools (z.B. Kahoot, Quizlet, digitale Pinnw√§nde, Forms)?",
                        info: {
                            examples: "Kahoot-Quiz f√ºr Lernstandskontrollen, Padlet/Pinnwand von Fobizz f√ºr Brainstorming, Microsoft Forms f√ºr Umfragen, Mentimeter f√ºr Live-Abstimmungen",
                            tools: "Kahoot, Pinnwand von Fobizz, Microsoft Forms, Quizlet, Mentimeter",
                            tips: "Starten Sie mit einfachen Tools. Bereiten Sie immer eine Alternative ohne Technik vor.",
                            ikt: "HE üí° - Kreativit√§t",
                            paed: "PL üéì - Aktives Lernen"
                        },
                        options: [
                            { value: 4, text: "Sehr interaktiv - Ich nutze regelm√§ssig verschiedene interaktive Tools" },
                            { value: 3, text: "Interaktiv - Ich setze gelegentlich interaktive Elemente ein" },
                            { value: 2, text: "Wenig interaktiv - Ich nutze selten interaktive Tools" },
                            { value: 1, text: "Nicht interaktiv - Ich kenne diese Tools kaum" }
                        ]
                    },
                    {
                        id: 6,
                        text: "Wie setzen Sie E-Assessments f√ºr die Leistungserfassung ein?",
                        info: {
                            examples: "Online-Tests in OpenOlat/Forms/to-teach.ai, Portfolio-Arbeit in OneNote, Peer-Feedback √ºber Teams",
                            tools: "Microsoft Forms, Tests OpenOlat, Team Aufgabenbaustein, √úbungsbaustein in OpenOlat",
                            tips: "Kombinieren Sie formative und summative Assessments. Geben Sie zeitnahes digitales Feedback.",
                            ikt: "KM ‚öôÔ∏è - Automatisierung",
                            paed: "PL üéì - Lernf√∂rderung"
                        },
                        options: [
                            { value: 4, text: "Systematisch - Ich nutze regelm√§ssig formative und summative E-Assessments" },
                            { value: 3, text: "H√§ufig - Ich setze E-Assessments f√ºr Tests und Pr√ºfungen ein" },
                            { value: 2, text: "Gelegentlich - Ich experimentiere mit digitalen Bewertungsformen" },
                            { value: 1, text: "Nie - Ich nutze nur traditionelle Bewertungsmethoden" }
                        ]
                    }
                ]
            },
            {
                id: 3,
                name: "Medien- und Informationskompetenz",
                description: "Informationen kritisch bewerten, Medien reflektiert nutzen und neue Medieninhalte gezielt erstellen. Lernende bei der Orientierung in der digitalen Informationsflut unterst√ºtzen.",
                questions: [
                    {
                        id: 7,
                        text: "Wie gut kennen Sie die Funktionsweise von Social Media und deren m√∂gliche Einsatzorte im Unterricht?",
                        info: {
                            examples: "In Teamskan√§len f√ºr Auftr√§ge, Tiktok f√ºr aktuelle Nachrichten analysieren, Instagram f√ºr visuelle Projekte, Algorithmenstrukturen beeinflussen, LinkedIn f√ºr Berufsorientierung",
                            tools: "Teams-Chat, Instagram, TikTok, LinkedIn, YouTube, Pinterest",
                            tips: "Thematisieren Sie Datenschutz und digitale Identit√§t. Nutzen Sie Social Media als Analysegegenstand",
                            ikt: "KR üîç - Kritische Reflexion",
                            paed: "PL üéì - Medienkompetenz"
                        },
                        options: [
                            { value: 4, text: "Sehr gut - Ich kenne verschiedene Plattformen und ihre didaktischen M√∂glichkeiten" },
                            { value: 3, text: "Gut - Ich verstehe die Grundprinzipien und nutze sie gelegentlich" },
                            { value: 2, text: "Grundkenntnisse - Ich kenne Social Media privat, aber nicht f√ºr den Unterricht" },
                            { value: 1, text: "Wenig - Ich habe kaum Erfahrung mit Social Media" }
                        ]
                    },
                    {
                        id: 8,
                        text: "K√∂nnen Sie multimediale Inhalte (Videos, Podcasts, interaktive Pr√§sentationen) f√ºr Ihren Unterricht erstellen?",
                        info: {
                            examples: "Lernvideos mit OpenOlat, to-teach.ai, clipchamp, Podcasts mit Aufnahmeanlage der BBW, Interaktive Pr√§sentationen mit Powerpoint, Erkl√§rvideos mit Screencast-Tools",
                            tools: "Clipchamp von Microsoft, Adobe Creativ Cloud, Lumi Education, to-teach.ai",
                            tips: "Beginnen Sie mit kurzen Videos (3-5 Minuten). Nutzen Sie vorhandene Vorlagen und Assets.",
                            ikt: "MF üîì - Medienfreiheit",
                            paed: "PDM üõ†Ô∏è - Kreative Methoden"
                        },
                        options: [
                            { value: 4, text: "Ja, professionell - Ich erstelle regelm√§ssig hochwertige multimediale Inhalte" },
                            { value: 3, text: "Ja, gut - Ich kann verschiedene Medienformate erstellen" },
                            { value: 2, text: "Teilweise - Ich kann einfache Videos oder Audiodateien erstellen" },
                            { value: 1, text: "Nein - Ich nutze nur vorgefertigte Inhalte" }
                        ]
                    },
                    {
                        id: 9,
                        text: "Wie vermitteln Sie Ihren Lernenden kritische Medienkompetenz und Quellenpr√ºfung?",
                        info: {
                            examples: "Fake News erkennen, Quellenangaben pr√ºfen, Bildmanipulation verstehen, Algorithmen hinterfragen, Filterblasen thematisieren",
                            tools: "Faktencheck-Seiten, Reverse Image Search, Media Bias Chart, Analyse von Ergebnissen KI-Suchmaschinen",
                            tips: "Nutzen Sie aktuelle Beispiele aus der Lebenswelt der Lernenden. √úben Sie anhand konkreter F√§lle.",
                            ikt: "KR üîç - Kritisches Denken",
                            paed: "PU üìö - Urteilsf√§higkeit"
                        },
                        options: [
                            { value: 4, text: "Systematisch - Es ist fester Bestandteil meines Unterrichts" },
                            { value: 3, text: "Regelm√§ssig - Ich thematisiere es bei passenden Gelegenheiten" },
                            { value: 2, text: "Gelegentlich - Ich spreche es manchmal an" },
                            { value: 1, text: "Selten - Es ist kein Schwerpunkt in meinem Unterricht" }
                        ]
                    }
                ]
            },
            {
                id: 4,
                name: "Datenverwaltung und Datensicherheit",
                description: "Verantwortungsvoller Umgang mit digitalen Daten sowie die F√§higkeit, personenbezogene und sensible Informationen im schulischen Kontext zu sch√ºtzen.",
                questions: [
                    {
                        id: 10,
                        text: "Wie gut kennen Sie die rechtlichen Grundlagen zum Datenschutz im schulischen Kontext?",
                        info: {
                            examples: "Datenschutzprinzipien, Einwilligungen f√ºr Fotos, sichere Notenverwaltung, anomysierte Inhalte bei digitalen Kommunikationen, Schutzeinstellungen bei Dateien",
                            tools: "Schulische Datenschutzrichtlinien, Leitf√§den Datenschutzbeauftrage Kt. Z√ºrich, begrenzte Zug√§nge auf Dateien erstellen",
                            tips: "Besuchen Sie Datenschutz-Schulungen. Dokumentieren Sie Ihre Datenverarbeitungsprozesse.",
                            ikt: "KR üîç - Rechtssicherheit",
                            paed: "PLL üë• - Verantwortung"
                        },
                        options: [
                            { value: 4, text: "Sehr gut - Ich kenne Datenschutzrichtlinien des Kantons und schulische Richtlinien im Detail" },
                            { value: 3, text: "Gut - Ich kenne die wichtigsten Regelungen" },
                            { value: 2, text: "Grundkenntnisse - Ich kenne die Basics" },
                            { value: 1, text: "Wenig - Ich bin unsicher bei Datenschutzfragen" }
                        ]
                    },
                    {
                        id: 11,
                        text: "Wie verwalten Sie Ihre Passw√∂rter und Zugangsdaten?",
                        info: {
                            examples: "systematische Passwort-Organisation, 2-Faktor-Authentifizierung, regelm√§ssige Passwort-Updates, sichere Passwort-Richtlinien",
                            tools: "Passwortmanagement, Microsoft Authenticator, Google Authenticator",
                            tips: "Nutzen Sie f√ºr jeden Dienst ein eigenes Passwort. Aktivieren Sie √ºberall 2FA wo m√∂glich.",
                            ikt: "DS üîí - Datensicherheit",
                            paed: "PU üìö - Eigenverantwortung"
                        },
                        options: [
                            { value: 4, text: "Professionell - Ich nutze einen Passwort-Manager/-Organisation und 2-Faktor-Authentifizierung" },
                            { value: 3, text: "Sicher - Ich verwende starke, unterschiedliche Passw√∂rter" },
                            { value: 2, text: "Ausreichend - Ich habe einige sichere Passw√∂rter" },
                            { value: 1, text: "Unsicher - Ich verwende oft dieselben oder einfache Passw√∂rter" }
                        ]
                    },
                    {
                        id: 12,
                        text: "Wie strukturiert verwalten Sie digitale Unterrichtsmaterialien und Lernendendaten?",
                        info: {
                            examples: "Klare Ordnerstruktur nach Jahr/Klasse/Fach, regelm√§ssige Backups, Versionierung von Dokumenten, Zugangsregel bei Dateien",
                            tools: "Zugangsregel OneDrive, Teams, Backup-Software, Synchronisation Explorer mit OneDrive",
                            tips: "Erstellen Sie ein einheitliches Benennungsschema. Automatisieren Sie Backups.",
                            ikt: "RE üíö - Effizienz",
                            paed: "PLK üè´ - Professionalit√§t"
                        },
                        options: [
                            { value: 4, text: "Sehr strukturiert - Mit klarem System, Zugangsregeln und Cloudsynchronisation" },
                            { value: 3, text: "Strukturiert - Mit Ordnerstruktur und Cloudsynchronisiation" },
                            { value: 2, text: "Teilweise strukturiert - Grundlegende Ordnung vorhanden" },
                            { value: 1, text: "Unstrukturiert - Wenig System in der Datenverwaltung" }
                        ]
                    }
                ]
            },
            {
                id: 5,
                name: "Kommunikation und Kollaboration",
                description: "Alle F√§higkeiten zur digitalen Interaktion, Zusammenarbeit und Kommunikation. Digitale Medien f√ºr den professionellen Austausch nutzen und kollaborative Lernprozesse gestalten.",
                questions: [
                    {
                        id: 13,
                        text: "Wie aktiv nutzen Sie Teams oder √§hnliche Plattformen f√ºr die Kommunikation mit Kollegium und Lernenden?",
                        info: {
                            examples: "Teams-Kan√§le f√ºr Klasseninfos und Austausch im Kollegium, Chat f√ºr schnelle Absprachen, Videobesprechungen f√ºr Fragen von zu Hause aus, Dateifreigabe f√ºr Materialien",
                            tools: "Microsoft Teams",
                            tips: "Definieren Sie klare Kommunikationsregeln. Nutzen Sie Kan√§le thematisch.",
                            ikt: "KN üåê - Vernetzung",
                            paed: "PL üéì - Zusammenarbeit"
                        },
                        options: [
                            { value: 4, text: "Sehr aktiv - T√§gliche Nutzung f√ºr verschiedene Zwecke" },
                            { value: 3, text: "Aktiv - Regelm√§ssige Nutzung mehrmals pro Woche" },
                            { value: 2, text: "Gelegentlich - Bei Bedarf oder f√ºr spezielle Projekte" },
                            { value: 1, text: "Selten - Nur wenn unbedingt n√∂tig" }
                        ]
                    },
                    {
                        id: 14,
                        text: "Wie gut k√∂nnen Sie kollaborative Dokumente (z.B. in Teams/OneDrive) f√ºr gemeinsame Projekte nutzen?",
                        info: {
                            examples: "Gemeinsame Unterrichtsplanung in Teams, Simultane Bearbeitung von Dokumenten, Projektplanung in OneNote",
                            tools: "Officeprogramme, Teams, OneDrive, SharePoint, OneNote",
                            tips: "Nutzen Sie die Kommentarfunktion f√ºr Feedback. Aktivieren Sie die Versionsverwaltung.",
                            ikt: "KA ü§ù - Kollaboration",
                            paed: "PU üìö - Teamarbeit"
                        },
                        options: [
                            { value: 4, text: "Expertenniveau - Ich kann komplexe kollaborative Projekte leiten" },
                            { value: 3, text: "Gut - Ich arbeite routiniert mit geteilten Dokumenten" },
                            { value: 2, text: "Grundkenntnisse - Ich kann an geteilten Dokumenten mitarbeiten" },
                            { value: 1, text: "Wenig Erfahrung - Ich arbeite lieber mit lokalen Dateien" }
                        ]
                    },
                    {
                        id: 15,
                        text: "Wie professionell ist Ihre digitale Kommunikation (Netiquette, Antwortzeiten, Strukturierung)?",
                        info: {
                            examples: "Organisation mit E-Mailprogrammen, zeitnahe Antworten (24-48h), Signatur mit Kontaktdaten, E-Mail-App auf Smartphone",
                            tools: "E-Mailverwaltungsprogramme wie Outlook/Thunderbird, E-Mail-Signatur, Abwesenheitsnotiz, Kalender-Freigabe",
                            tips: "Organisation der E-Mails mit Smartphone, Zeitplanung f√ºr die Beantwortung von Nachrichten",
                            ikt: "MG üõ†Ô∏è - Management",
                            paed: "PLL üë• - Professionalit√§t"
                        },
                        options: [
                            { value: 4, text: "Sehr professionell - Genaue Verwaltung der Nachrichten, zeitnahe Antworten, professioneller Ton" },
                            { value: 3, text: "Professionell - Meist zeitnah und angemessen" },
                            { value: 2, text: "Ausreichend - Grundlegende H√∂flichkeit, gelegentliche Verz√∂gerungen" },
                            { value: 1, text: "Verbesserungsw√ºrdig - Unregelm√§ssige Kommunikation" }
                        ]
                    }
                ]
            }
        ];

        // State Management
        let currentSectionIndex = 0;
        let answers = {};
        let testCode = "";
        let testStartTime = null;

        // Start Test Function
        window.startTest = function() {
            const codeInput = document.getElementById('accessCode');
            const code = codeInput.value.trim().toUpperCase();
            
            console.log('Eingegebener Code:', code);
            
            if (code.length < 4) {
                alert('Bitte geben Sie einen g√ºltigen Code ein.');
                return;
            }
            
            testCode = code;
            testStartTime = new Date();
            
            // Hide code entry, show test
            document.getElementById('codeEntry').style.display = 'none';
            document.getElementById('testSection').classList.add('active');
            
            // Initialize first section
            showSection(0);
        }

        // Show Section Function
        window.showSection = function(sectionIndex) {
            const section = sections[sectionIndex];
            const container = document.getElementById('sectionContainer');
            
            // Update progress bar
            const progress = Math.round(((sectionIndex + 1) / sections.length) * 100);
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = `Bereich ${sectionIndex + 1} von ${sections.length}`;
            
            // Create section HTML
            let sectionHTML = `
                <div class="section-header">
                    <h2 class="section-title">${section.name}</h2>
                    <p class="section-description">${section.description}</p>
                </div>
            `;
            
            // Add all questions for this section
            section.questions.forEach((question, qIndex) => {
                const isAnswered = answers[question.id] !== undefined;
                
                sectionHTML += `
                    <div class="question-card ${isAnswered ? 'answered' : ''}" id="question-${question.id}">
                        <div class="question-header">
                            <span class="category-badge category-${section.id}">
                                Frage ${qIndex + 1} von ${section.questions.length}
                            </span>
                        </div>
                        <div class="question-text">
                            <span style="flex: 1;">${question.text}</span>
                            <button class="info-button" onclick="toggleInfo(${question.id})" title="Mehr Informationen">
                                ?
                            </button>
                        </div>
                        <div id="info-${question.id}" class="info-box">
                            <h4>üìç Praktische Beispiele</h4>
                            <p>${question.info.examples}</p>
                            
                            <h4>üõ†Ô∏è Empfohlene Tools</h4>
                            <p>${question.info.tools}</p>
                            
                            <h4>üí° Tipp</h4>
                            <p>${question.info.tips}</p>
                            
                            <div class="concept-tags">
                                <span class="concept-tag ikt-tag">${question.info.ikt}</span>
                                <span class="concept-tag paed-tag">${question.info.paed}</span>
                            </div>
                        </div>
                        <div class="answer-options">
                            ${question.options.map((option, i) => `
                                <div class="answer-option ${answers[question.id] === option.value ? 'selected' : ''}" 
                                     onclick="selectAnswer(${question.id}, ${option.value}, this)">
                                    <input type="radio" 
                                           name="question${question.id}" 
                                           value="${option.value}"
                                           ${answers[question.id] === option.value ? 'checked' : ''}>
                                    <label>${option.text}</label>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = sectionHTML;
            
            // Update navigation buttons
            document.getElementById('prevButton').style.display = sectionIndex === 0 ? 'none' : 'block';
            document.getElementById('nextButton').style.display = sectionIndex === sections.length - 1 ? 'none' : 'block';
            document.getElementById('submitButton').style.display = sectionIndex === sections.length - 1 ? 'block' : 'none';
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Toggle Info Box Function
        window.toggleInfo = function(questionId) {
            const infoBox = document.getElementById(`info-${questionId}`);
            if (infoBox) {
                infoBox.classList.toggle('active');
            }
        }

        // Select Answer Function
        window.selectAnswer = function(questionId, value, element) {
            answers[questionId] = value;
            
            // Update UI
            const questionCard = document.getElementById(`question-${questionId}`);
            questionCard.classList.add('answered');
            
            // Update selected state for this question's options
            const options = questionCard.querySelectorAll('.answer-option');
            options.forEach(option => {
                option.classList.remove('selected');
            });
            element.classList.add('selected');
            element.querySelector('input').checked = true;
        }

        // Check if all questions in current section are answered
        window.checkSectionComplete = function() {
            const currentSection = sections[currentSectionIndex];
            for (let question of currentSection.questions) {
                if (!answers[question.id]) {
                    return false;
                }
            }
            return true;
        }

        // Navigation Functions
        window.previousSection = function() {
            if (currentSectionIndex > 0) {
                currentSectionIndex--;
                showSection(currentSectionIndex);
            }
        }

        window.nextSection = function() {
            if (!checkSectionComplete()) {
                alert('Bitte beantworten Sie alle Fragen in diesem Bereich.');
                return;
            }
            
            if (currentSectionIndex < sections.length - 1) {
                currentSectionIndex++;
                showSection(currentSectionIndex);
            }
        }

        // Submit Test Function
        window.submitTest = function() {
            if (!checkSectionComplete()) {
                alert('Bitte beantworten Sie alle Fragen in diesem Bereich.');
                return;
            }
            
            // Calculate results
            const results = calculateResults();
            
            // Save to Firebase and localStorage
            saveResults(results);
            
            // Show results
            showResults(results);
        }

        // Calculate Results Function
        window.calculateResults = function() {
            const categoryScores = {};
            const categoryMaxScores = {};
            const categoryQuestions = {};
            
            // Initialize categories
            for (let i = 1; i <= 5; i++) {
                categoryScores[i] = 0;
                categoryMaxScores[i] = 0;
                categoryQuestions[i] = 0;
            }
            
            // Calculate scores per category
            sections.forEach(section => {
                section.questions.forEach(question => {
                    if (answers[question.id]) {
                        categoryScores[section.id] += answers[question.id];
                        categoryMaxScores[section.id] += 4; // Max score per question is 4
                        categoryQuestions[section.id]++;
                    }
                });
            });
            
            // Calculate percentages
            const categoryPercentages = {};
            for (let i = 1; i <= 5; i++) {
                if (categoryMaxScores[i] > 0) {
                    categoryPercentages[i] = Math.round((categoryScores[i] / categoryMaxScores[i]) * 100);
                } else {
                    categoryPercentages[i] = 0;
                }
            }
            
            // Calculate total score
            const totalScore = Object.values(categoryScores).reduce((a, b) => a + b, 0);
            const totalMaxScore = Object.values(categoryMaxScores).reduce((a, b) => a + b, 0);
            const totalPercentage = Math.round((totalScore / totalMaxScore) * 100);
            
            return {
                totalScore,
                totalMaxScore,
                totalPercentage,
                categoryScores,
                categoryMaxScores,
                categoryPercentages,
                testCode,
                timestamp: new Date().toISOString(),
                duration: Math.round((new Date() - testStartTime) / 1000) // in seconds
            };
        }

        // Show Results Function
        window.showResults = function(results) {
            // Hide test section
            document.getElementById('testSection').classList.remove('active');
            
            // Show results section
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.classList.add('active');
            
            // Set score circle
            const scoreCircle = document.getElementById('scoreCircle');
            const scoreText = document.getElementById('scoreText');
            
            scoreCircle.textContent = results.totalPercentage + '%';
            
            if (results.totalPercentage >= 80) {
                scoreCircle.className = 'score-circle score-excellent';
                scoreText.textContent = 'Ausgezeichnet! Sie verf√ºgen √ºber sehr gute digitale Kompetenzen.';
            } else if (results.totalPercentage >= 60) {
                scoreCircle.className = 'score-circle score-good';
                scoreText.textContent = 'Gut! Sie haben solide digitale Kompetenzen mit Entwicklungspotenzial.';
            } else {
                scoreCircle.className = 'score-circle score-needs-improvement';
                scoreText.textContent = 'Es besteht Entwicklungsbedarf in mehreren Bereichen.';
            }
            
            // Category Results
            const categoryNames = [
                "Grundkenntnisse IKT",
                "Anwendung im Unterricht",
                "Medien- und Informationskompetenz",
                "Datenverwaltung und Datensicherheit",
                "Kommunikation und Kollaboration"
            ];
            
            const categoryResultsHTML = categoryNames.map((name, i) => {
                const categoryNum = i + 1;
                const percentage = results.categoryPercentages[categoryNum];
                const barColor = percentage >= 80 ? '#28a745' : percentage >= 60 ? '#ffc107' : '#dc3545';
                
                return `
                    <div class="category-result">
                        <div class="category-result-header">
                            <span class="category-result-title">${name}</span>
                            <span class="category-result-score">${percentage}%</span>
                        </div>
                        <div class="result-bar-container">
                            <div class="result-bar" 
                                 style="width: ${percentage}%; background: ${barColor};">
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('categoryResults').innerHTML = categoryResultsHTML;
            
            // Recommendations
            const recommendations = generateRecommendations(results);
            const recommendationsHTML = recommendations.map(rec => `
                <div class="recommendation-item">
                    <strong>${rec.title}:</strong> ${rec.text}
                </div>
            `).join('');
            
            document.getElementById('recommendationsList').innerHTML = recommendationsHTML;
        }

        // Generate Recommendations Function
        window.generateRecommendations = function(results) {
            const recommendations = [];
            const categoryNames = [
                "Grundkenntnisse IKT",
                "Anwendung im Unterricht",
                "Medien- und Informationskompetenz",
                "Datenverwaltung und Datensicherheit",
                "Kommunikation und Kollaboration"
            ];
            
            const categoryRecommendations = {
                1: [
                    "Besuchen Sie Basis-Schulungen zu Office 365 und Cloud-Diensten",
                    "Nutzen Sie die IT-Sprechstunde f√ºr individuelle Unterst√ºtzung",
                    "Erkunden Sie die Ed-Tech-Lizenzen Ihrer Schule systematisch"
                ],
                2: [
                    "Experimentieren Sie mit interaktiven Tools wie Kahoot oder Padlet",
                    "Besuchen Sie Workshops zu digitaler Unterrichtsgestaltung",
                    "Tauschen Sie sich mit digital-affinen Kollegen aus"
                ],
                3: [
                    "Lernen Sie Tools zur Erstellung multimedialer Inhalte kennen",
                    "Integrieren Sie Medienkritik als festen Unterrichtsbestandteil",
                    "Erkunden Sie die didaktischen M√∂glichkeiten von Social Media"
                ],
                4: [
                    "Nehmen Sie an einer Datenschutz-Schulung teil",
                    "Implementieren Sie ein Passwort-Management-System",
                    "Entwickeln Sie eine strukturierte Dateiablage"
                ],
                5: [
                    "Nutzen Sie Teams aktiver f√ºr die Zusammenarbeit",
                    "Lernen Sie kollaborative Arbeitsweisen kennen",
                    "Verbessern Sie Ihre digitale Kommunikationsstruktur"
                ]
            };
            
            // Find weakest areas (below 60%)
            for (let i = 1; i <= 5; i++) {
                if (results.categoryPercentages[i] < 60) {
                    const recList = categoryRecommendations[i];
                    recommendations.push({
                        title: categoryNames[i - 1],
                        text: recList[Math.floor(Math.random() * recList.length)]
                    });
                }
            }
            
            // If no weak areas, suggest advanced topics
            if (recommendations.length === 0) {
                recommendations.push({
                    title: "Fortgeschrittene Kompetenzen",
                    text: "Erkunden Sie KI-Tools f√ºr den Unterricht und werden Sie Digital-Mentor f√ºr Ihr Kollegium"
                });
            }
            
            return recommendations.slice(0, 3); // Return max 3 recommendations
        }

        // Save Results Function with Firebase-Integration
        async function saveResults(results) {
            // Lokale Speicherung (Backup)
            let allResults = JSON.parse(localStorage.getItem('bbw_test_results') || '[]');
            allResults.push(results);
            localStorage.setItem('bbw_test_results', JSON.stringify(allResults));
            
            // Firebase Speicherung
            if (firebaseReady && db) {
                try {
                    // Pr√ºfe ob Code existiert
                    const codesRef = collection(db, 'codes');
                    const q = query(codesRef, where("code", "==", results.testCode));
                    const querySnapshot = await getDocs(q);
                    
                    if (!querySnapshot.empty || results.testCode === "0HDM-V3EU" || results.testCode === "TEST-1234") {
                        // Code existiert oder ist Test-Code - speichere Ergebnis
                        const resultsRef = collection(db, 'results');
                        await addDoc(resultsRef, {
                            ...results,
                            createdAt: serverTimestamp()
                        });
                        console.log("Ergebnisse in Firebase gespeichert");
                    } else {
                        console.warn("Ung√ºltiger Code - Ergebnisse nur lokal gespeichert");
                        alert("Hinweis: Der verwendete Code ist ung√ºltig oder abgelaufen. Ihre Ergebnisse wurden nur lokal gespeichert.");
                    }
                } catch (error) {
                    console.error("Fehler beim Speichern in Firebase:", error);
                    alert("Ihre Ergebnisse konnten nicht online gespeichert werden. Sie wurden nur lokal gespeichert.");
                }
            } else {
                console.log("Firebase nicht verf√ºgbar - nur lokale Speicherung");
            }
        }

        // Restart Test Function
        window.restartTest = function() {
            // Reset all variables
            currentSectionIndex = 0;
            answers = {};
            testCode = "";
            testStartTime = null;
            
            // Reset UI
            document.getElementById('resultsSection').classList.remove('active');
            document.getElementById('testSection').classList.remove('active');
            document.getElementById('codeEntry').style.display = 'block';
            document.getElementById('accessCode').value = '';
        }

        // Enable Enter key for code input
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('accessCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    startTest();
                }
            });
        });
    </script>
</body>
</html>
